---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allExercises = await getCollection('exercises');

// Group exercises by year
const exercisesByYear = allExercises.reduce((acc, exercise) => {
  const year = exercise.slug.split('/')[0];
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(exercise);
  return acc;
}, {} as Record<string, typeof allExercises>);

// Sort exercises within each year by day number
Object.keys(exercisesByYear).forEach(year => {
  exercisesByYear[year].sort((a, b) => {
    const dayA = parseInt(a.slug.split('/')[1].replace('day', ''));
    const dayB = parseInt(b.slug.split('/')[1].replace('day', ''));
    return dayA - dayB;
  });
});

// Sort years in descending order (newest first)
const sortedYears = Object.keys(exercisesByYear).sort((a, b) => parseInt(b) - parseInt(a));
---

<Layout title="Advent of JavaScript - Exercises">
  <h1>ðŸŽ„ Advent of JavaScript</h1>
  <p class="subtitle">Daily coding challenges and solutions</p>

  {sortedYears.map(year => (
    <section class="year-section">
      <h2>{year}</h2>
      <div class="exercises-grid">
        {exercisesByYear[year].map(exercise => {
          const dayNum = exercise.slug.split('/')[1].replace('day', '');
          return (
            <a href={`/${exercise.slug}`} class="exercise-card">
              <span class="day-badge">Day {dayNum}</span>
              <h3>{exercise.data.title || `DÃ­a ${dayNum}`}</h3>
            </a>
          );
        })}
      </div>
    </section>
  ))}
</Layout>

<style>
  h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  .subtitle {
    font-size: 1.25rem;
    color: #94a3b8;
    margin-bottom: 3rem;
  }

  .year-section {
    margin-bottom: 3rem;
  }

  .year-section h2 {
    font-size: 2rem;
    color: var(--accent);
    margin-bottom: 1rem;
    border-bottom: 2px solid var(--accent);
    padding-bottom: 0.5rem;
  }

  .exercises-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
  }

  .exercise-card {
    background: var(--code-bg);
    border: 2px solid #334155;
    border-radius: 8px;
    padding: 1.5rem;
    text-decoration: none;
    color: var(--text);
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .exercise-card:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
  }

  .day-badge {
    display: inline-block;
    background: var(--accent);
    color: var(--bg);
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: bold;
    width: fit-content;
  }

  .exercise-card h3 {
    font-size: 1rem;
    line-height: 1.4;
  }
</style>
